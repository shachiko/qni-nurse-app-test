<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QNI-NurseGuard - Giám sát Quy trình</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải thư viện biểu đồ Chart.js (để làm báo cáo đẹp hơn) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Sử dụng font Inter cho giao diện sạch sẽ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ẩn các view (màn hình) ban đầu */
        .view {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Container chính của ứng dụng -->
    <div class="container mx-auto max-w-4xl p-4 min-h-screen">

        <!-- Header chung -->
        <header class="bg-white shadow-md rounded-lg p-4 mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-blue-700">QNI-NurseGuard</h1>
                <p class="text-sm text-gray-500">Bệnh viện Đa khoa tỉnh Quảng Ninh</p>
            </div>
            <div id="userInfo" class="text-right">
                <!-- Thông tin người dùng sẽ hiển thị ở đây -->
            </div>
        </header>

        <!-- (VIEW 1) Màn hình Đăng nhập -->
        <div id="loginView" class="view bg-white p-8 rounded-lg shadow-lg max-w-md mx-auto">
            <h2 class="text-xl font-semibold text-center mb-6">Đăng nhập hệ thống</h2>
            <div class="mb-4">
                <label for="userSelect" class="block text-sm font-medium text-gray-700 mb-2">Chọn vai trò của bạn:</label>
                <select id="userSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="nurse_a">Điều dưỡng: Nguyễn Thị A</option>
                    <option value="nurse_b">Điều dưỡng: Trần Văn B</option>
                    <option value="manager">Quản lý: Điều dưỡng trưởng</option>
                </select>
            </div>
            <button onclick="login()" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200">
                Đăng nhập
            </button>
        </div>

        <!-- (VIEW 2) Màn hình chính - Điều dưỡng -->
        <div id="nurseDashboardView" class="view">
            <h2 class="text-xl font-semibold mb-4">Quy trình kỹ thuật cần thực hiện</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Card cho quy trình tiêm -->
                <div class="procedure-card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-200">
                    <h3 class="font-bold text-lg text-blue-700">Tiêm tĩnh mạch</h3>
                    <p class="text-sm text-gray-600 mt-2 mb-4">Quy trình kỹ thuật tiêm tĩnh mạch theo chuẩn Bộ Y tế.</p>
                    <button onclick="startProcedure('iv_injection')" class="w-full bg-green-600 text-white p-2 rounded-lg font-semibold hover:bg-green-700">
                        Bắt đầu thực hiện
                    </button>
                </div>
                <!-- Card cho quy trình thay băng -->
                <div class="procedure-card bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-200">
                    <h3 class="font-bold text-lg text-orange-700">Thay băng vết mổ</h3>
                    <p class="text-sm text-gray-600 mt-2 mb-4">Quy trình thay băng và chăm sóc vết mổ sạch.</p>
                    <button onclick="startProcedure('dressing_change')" class="w-full bg-green-600 text-white p-2 rounded-lg font-semibold hover:bg-green-700">
                        Bắt đầu thực hiện
                    </button>
                </div>
                <!-- Thêm các quy trình khác ở đây -->
                <div class="procedure-card bg-white p-6 rounded-lg shadow-lg opacity-50">
                    <h3 class="font-bold text-lg text-gray-500">Chăm sóc người bệnh thở máy</h3>
                    <p class="text-sm text-gray-500 mt-2 mb-4">(Sắp ra mắt)</p>
                    <button class="w-full bg-gray-400 text-white p-2 rounded-lg font-semibold cursor-not-allowed">
                        Bắt đầu thực hiện
                    </button>
                </div>
            </div>
        </div>

        <!-- (VIEW 3) Màn hình Bảng kiểm Quy trình -->
        <div id="procedureChecklistView" class="view">
            <button onclick="showView('nurseDashboardView')" class="mb-4 text-blue-600 hover:text-blue-800">
                &larr; Quay lại Dashboard
            </button>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <h2 id="checklistTitle" class="text-xl font-bold mb-2"></h2>
                <p class="text-sm text-gray-500 mb-6">Mô phỏng AI giám sát: Vui lòng tích vào từng bước khi bạn hoàn thành.</p>
                <div id="checklistSteps" class="space-y-3">
                    <!-- Các bước trong bảng kiểm sẽ được JS chèn vào đây -->
                </div>
                <input type="hidden" id="currentProcedureKey">
                <button onclick="submitChecklist()" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 mt-8">
                    Hoàn thành & Gửi AI Phân tích
                </button>
            </div>
        </div>

        <!-- (VIEW 4) Màn hình Phản hồi của AI -->
        <div id="aiFeedbackView" class="view">
            <div class="bg-white p-8 rounded-lg shadow-lg max-w-lg mx-auto text-center">
                <h2 class="text-xl font-bold mb-4">Phân tích từ AI</h2>
                <div id="feedbackContent">
                    <!-- Nội dung phản hồi của AI sẽ được chèn vào đây -->
                </div>
                <button onclick="showView('nurseDashboardView')" class="mt-6 bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200">
                    Trở về Dashboard
                </button>
            </div>
        </div>

        <!-- (VIEW 5) Màn hình Quản lý -->
        <div id="managerDashboardView" class="view">
            <h2 class="text-xl font-semibold mb-4">Báo cáo Tuân thủ Quy trình (Toàn khoa)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Thống kê chung -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold text-lg mb-4">Tổng quan Tuân thủ</h3>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-blue-700">Tiêm tĩnh mạch</span>
                                <span id="complianceRate-iv_injection" class="text-sm font-medium text-blue-700"></span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div id="complianceBar-iv_injection" class="bg-blue-600 h-4 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-orange-700">Thay băng vết mổ</span>
                                <span id="complianceRate-dressing_change" class="text-sm font-medium text-orange-700"></span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div id="complianceBar-dressing_change" class="bg-orange-500 h-4 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lỗi thường gặp -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold text-lg mb-4">Các lỗi thường gặp nhất</h3>
                    <ul id="commonErrorsList" class="list-disc list-inside space-y-2 text-sm text-red-600">
                        <!-- Danh sách lỗi sẽ được JS chèn vào đây -->
                        <li>Không tìm thấy dữ liệu</li>
                    </ul>
                </div>
            </div>

            <!-- Biểu đồ tuân thủ theo thời gian -->
            <div class="bg-white p-6 rounded-lg shadow-lg mt-6">
                <h3 class="font-bold text-lg mb-4">Xu hướng Tuân thủ (7 ngày qua)</h3>
                <canvas id="complianceChart"></canvas>
            </div>
        </div>

    </div> <!-- Hết container -->

    <script>
        // --- CSDL MÔ PHỎNG ---

        // (1) Định nghĩa các quy trình chuẩn của Bộ Y tế
        const mohStandards = {
            'iv_injection': {
                title: 'Quy trình: Tiêm tĩnh mạch',
                steps: [
                    { id: 'step1', text: 'Báo và giải thích cho người bệnh/người nhà.', required: true },
                    { id: 'step2', text: 'Chuẩn bị dụng cụ (bơm tiêm, kim, thuốc, bông cồn...).', required: true },
                    { id: 'step3', text: 'Điều dưỡng rửa tay thường quy/sát khuẩn tay nhanh.', required: true, isCritical: true, error: 'Bỏ qua vệ sinh tay (Lỗi nghiêm trọng)' },
                    { id: 'step4', text: 'Thực hiện 5 ĐÚNG (Tên BN, Tên thuốc, Liều, Đường dùng, Thời gian).', required: true, isCritical: true, error: 'Không kiểm tra 5 ĐÚNG' },
                    { id: 'step5', text: 'Lấy thuốc vào bơm tiêm, đuổi khí.', required: true },
                    { id: 'step6', text: 'Chọn vị trí tiêm, bộc lộ vùng tiêm.', required: true },
                    { id: 'step7', text: 'Buộc garo (cách vị trí tiêm 10-15cm).', required: true },
                    { id: 'step8', text: 'Sát khuẩn vị trí tiêm (xoắn ốc từ trong ra 5cm).', required: true },
                    { id: 'step9', text: 'Thực hiện kỹ thuật tiêm (đâm kim, hút kiểm tra, bơm thuốc).', required: true },
                    { id: 'step10', text: 'Tháo garo, rút kim, sát khuẩn lại, đặt bông gòn.', required: true },
                    { id: 'step11', text: 'Thu dọn dụng cụ, phân loại rác thải y tế.', required: true },
                    { id: 'step12', text: 'Ghi chép hồ sơ bệnh án.', required: true },
                ]
            },
            'dressing_change': {
                title: 'Quy trình: Thay băng vết mổ',
                steps: [
                    { id: 'step1', text: 'Báo và giải thích, nhận định tình trạng vết mổ.', required: true },
                    { id: 'step2', text: 'Điều dưỡng rửa tay thường quy/sát khuẩn tay nhanh.', required: true, isCritical: true, error: 'Bỏ qua vệ sinh tay (Lỗi nghiêm trọng)' },
                    { id: 'step3', text: 'Chuẩn bị bộ dụng cụ thay băng vô khuẩn.', required: true },
                    { id: 'step4', text: 'Tháo băng cũ (nhẹ nhàng, đúng kỹ thuật).', required: true },
                    { id: 'step5', text: 'Quan sát, đánh giá tình trạng vết mổ.', required: true },
                    { id: 'step6', text: 'Rửa vết mổ bằng dung dịch sát khuẩn (từ trong ra ngoài).', required: true },
                    { id: 'step7', text: 'Thấm khô vết mổ.', required: true },
                    { id: 'step8', text: 'Đắp gạc mới và băng lại.', required: true },
                    { id: 'step9', text: 'Thu dọn dụng cụ, phân loại rác thải.', required: true },
                    { id: 'step10', text: 'Ghi chép hồ sơ (tình trạng, dung dịch rửa...).', required: true },
                ]
            }
        };

        // (2) Biến toàn cục (Global state)
        let currentUser = null;
        let chartInstance = null; // Để lưu trữ biểu đồ
        // Dữ liệu giả lập cho báo cáo
        let procedureHistory = [
            { user: 'nurse_a', procedure: 'iv_injection', score: 11, total: 12, errors: ['Ghi chép hồ sơ bệnh án.'], timestamp: new Date(Date.now() - 3 * 86400000) },
            { user: 'nurse_b', procedure: 'iv_injection', score: 10, total: 12, errors: ['Buộc garo (cách vị trí tiêm 10-15cm).', 'Thực hiện 5 ĐÚNG (Tên BN, Tên thuốc, Liều, Đường dùng, Thời gian).'], timestamp: new Date(Date.now() - 2 * 86400000) },
            { user: 'nurse_a', procedure: 'dressing_change', score: 10, total: 10, errors: [], timestamp: new Date(Date.now() - 2 * 86400000) },
            { user: 'nurse_b', procedure: 'dressing_change', score: 8, total: 10, errors: ['Điều dưỡng rửa tay thường quy/sát khuẩn tay nhanh.', 'Ghi chép hồ sơ (tình trạng, dung dịch rửa...).'], timestamp: new Date(Date.now() - 1 * 86400000) },
            { user: 'nurse_a', procedure: 'iv_injection', score: 12, total: 12, errors: [], timestamp: new Date(Date.now() - 1 * 86400000) },
        ];

        // --- LOGIC ỨNG DỤNG ---

        // (1) Điều hướng màn hình
        function showView(viewId) {
            // Ẩn tất cả các view
            document.querySelectorAll('.view').forEach(view => {
                view.style.display = 'none';
            });
            // Hiển thị view mong muốn
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.style.display = 'block';
            }
        }

        // (2) Xử lý Đăng nhập
        function login() {
            const userSelect = document.getElementById('userSelect');
            currentUser = userSelect.value;
            const userName = userSelect.options[userSelect.selectedIndex].text;

            // Hiển thị thông tin người dùng trên header
            document.getElementById('userInfo').innerHTML = `
                <p class="font-semibold">${userName}</p>
                <a href="#" onclick="logout()" class="text-sm text-red-500 hover:underline">Đăng xuất</a>
            `;

            if (currentUser === 'manager') {
                // Nếu là quản lý, hiển thị dashboard quản lý
                updateManagerDashboard();
                showView('managerDashboardView');
            } else {
                // Nếu là điều dưỡng, hiển thị dashboard điều dưỡng
                showView('nurseDashboardView');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('userInfo').innerHTML = '';
            showView('loginView');
        }

        // (3) Bắt đầu một quy trình
        function startProcedure(procedureKey) {
            const procedure = mohStandards[procedureKey];
            if (!procedure) return;

            document.getElementById('checklistTitle').textContent = procedure.title;
            document.getElementById('currentProcedureKey').value = procedureKey;

            const stepsContainer = document.getElementById('checklistSteps');
            stepsContainer.innerHTML = ''; // Xóa các bước cũ

            // Tạo HTML cho từng bước
            procedure.steps.forEach(step => {
                const stepElement = document.createElement('div');
                stepElement.className = 'checklist-item p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center transition-colors duration-150';
                stepElement.dataset.stepId = step.id;
                stepElement.dataset.checked = 'false';
                stepElement.onclick = () => toggleStep(stepElement);

                stepElement.innerHTML = `
                    <div class="checkbox-icon w-6 h-6 mr-4 rounded-full border-2 border-gray-300 flex-shrink-0 flex items-center justify-center">
                        <!-- Icon check sẽ xuất hiện ở đây -->
                    </div>
                    <span class="flex-1">${step.text}</span>
                `;
                stepsContainer.appendChild(stepElement);
            });

            showView('procedureChecklistView');
        }

        // (4) Tích chọn một bước
        function toggleStep(stepElement) {
            const isChecked = stepElement.dataset.checked === 'true';
            const checkIconContainer = stepElement.querySelector('.checkbox-icon');

            if (isChecked) {
                stepElement.dataset.checked = 'false';
                stepElement.classList.remove('bg-green-50', 'border-green-300');
                stepElement.classList.add('border-gray-200');
                checkIconContainer.innerHTML = '';
                checkIconContainer.classList.remove('bg-green-600', 'border-green-600');
                checkIconContainer.classList.add('border-gray-300');
            } else {
                stepElement.dataset.checked = 'true';
                stepElement.classList.add('bg-green-50', 'border-green-300');
                stepElement.classList.remove('border-gray-200');
                checkIconContainer.classList.add('bg-green-600', 'border-green-600');
                checkIconContainer.classList.remove('border-gray-300');
                // Thêm icon check (SVG)
                checkIconContainer.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>`;
            }
        }

        // (5) Nộp bảng kiểm & Mô phỏng AI phân tích
        function submitChecklist() {
            const procedureKey = document.getElementById('currentProcedureKey').value;
            const procedure = mohStandards[procedureKey];
            const steps = document.querySelectorAll('.checklist-item');

            let score = 0;
            let total = procedure.steps.length;
            let missedSteps = [];
            let missedErrors = [];

            // "AI" quét qua các bước
            steps.forEach(stepElement => {
                const stepId = stepElement.dataset.stepId;
                const isChecked = stepElement.dataset.checked === 'true';
                const standardStep = procedure.steps.find(s => s.id === stepId);

                if (isChecked) {
                    score++;
                } else if (standardStep && standardStep.required) {
                    // Nếu bước này là bắt buộc mà không tích
                    missedSteps.push(standardStep.text);
                    if (standardStep.isCritical && standardStep.error) {
                        missedErrors.push(standardStep.error);
                    }
                }
            });

            // Lưu kết quả vào lịch sử
            procedureHistory.push({
                user: currentUser,
                procedure: procedureKey,
                score: score,
                total: total,
                errors: missedErrors.length > 0 ? missedErrors : (missedSteps.length > 0 ? missedSteps : []), // Ưu tiên lỗi nghiêm trọng
                timestamp: new Date()
            });

            // Tạo phản hồi
            generateAiFeedback(score, total, missedSteps, missedErrors);
            showView('aiFeedbackView');
        }

        // (6) Tạo nội dung phản hồi
        function generateAiFeedback(score, total, missedSteps, missedErrors) {
            const feedbackContainer = document.getElementById('feedbackContent');
            const compliance = Math.round((score / total) * 100);
            let html = '';

            if (compliance === 100) {
                html = `
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold text-green-700">TUÂN THỦ TUYỆT ĐỐI</h3>
                    <p class="mt-2 text-gray-600">Bạn đã thực hiện ${score}/${total} bước chính xác. Cảm ơn bạn đã tuân thủ quy trình!</p>
                `;
            } else {
                 const isCritical = missedErrors.length > 0;
                 const color = isCritical ? 'red' : 'yellow';
                 
                 html = `
                    <div class="w-20 h-20 bg-${color}-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-${color}-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold text-${color}-700">CẦN CẢI THIỆN (Tuân thủ ${compliance}%)</h3>
                    <p class="mt-2 text-gray-600">Bạn đã thực hiện ${score}/${total} bước. Vui lòng xem lại các điểm sau:</p>
                    <div class="mt-4 text-left bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">Các bước đã bỏ lỡ:</h4>
                        <ul class="list-disc list-inside text-sm ${isCritical ? 'text-red-700' : 'text-yellow-800'}">
                            ${(isCritical ? missedErrors : missedSteps).map(err => `<li>${err}</li>`).join('')}
                        </ul>
                    </div>
                    <p class="text-xs mt-4 text-gray-500">Hệ thống AI sẽ tự động cập nhật báo cáo cho quản lý và đề xuất nội dung đào tạo nếu cần thiết.</p>
                `;
            }

            feedbackContainer.innerHTML = html;
        }

        // (7) Cập nhật Dashboard của Quản lý
        function updateManagerDashboard() {
            // -- Phân tích dữ liệu --
            const commonErrors = {};
            const compliance = {
                'iv_injection': { score: 0, total: 0, count: 0 },
                'dressing_change': { score: 0, total: 0, count: 0 }
            };
            const dailyCompliance = {}; // Dữ liệu cho biểu đồ

            const now = new Date();
            const sevenDaysAgo = new Date(now.getTime() - 7 * 86400000);

            procedureHistory.forEach(record => {
                // Tính toán tỷ lệ tuân thủ
                if (compliance[record.procedure]) {
                    compliance[record.procedure].score += record.score;
                    compliance[record.procedure].total += record.total;
                    compliance[record.procedure].count++;
                }

                // Đếm lỗi
                record.errors.forEach(error => {
                    commonErrors[error] = (commonErrors[error] || 0) + 1;
                });

                // Tổng hợp dữ liệu biểu đồ (chỉ 7 ngày qua)
                if (record.timestamp >= sevenDaysAgo) {
                    const dateString = record.timestamp.toISOString().split('T')[0];
                    if (!dailyCompliance[dateString]) {
                        dailyCompliance[dateString] = { score: 0, total: 0 };
                    }
                    dailyCompliance[dateString].score += record.score;
                    dailyCompliance[dateString].total += record.total;
                }
            });

            // -- Cập nhật Thống kê chung --
            Object.keys(compliance).forEach(key => {
                const data = compliance[key];
                const rate = (data.total > 0) ? Math.round((data.score / data.total) * 100) : 0;
                
                const rateEl = document.getElementById(`complianceRate-${key}`);
                const barEl = document.getElementById(`complianceBar-${key}`);
                
                if(rateEl) rateEl.textContent = `${rate}% (${data.count} lượt)`;
                if(barEl) barEl.style.width = `${rate}%`;
            });

            // -- Cập nhật Lỗi thường gặp --
            const errorListEl = document.getElementById('commonErrorsList');
            const sortedErrors = Object.entries(commonErrors).sort((a, b) => b[1] - a[1]);
            
            if (sortedErrors.length > 0) {
                errorListEl.innerHTML = sortedErrors.slice(0, 5).map(([error, count]) => {
                    return `<li>${error} (${count} lần)</li>`;
                }).join('');
            } else {
                errorListEl.innerHTML = `<li class="text-green-600">Tuyệt vời! Không có lỗi nào được ghi nhận.</li>`;
            }
            
            // -- Cập nhật Biểu đồ --
            updateChart(dailyCompliance);
        }

        // (8) Vẽ biểu đồ
        function updateChart(dailyData) {
            const ctx = document.getElementById('complianceChart').getContext('2d');
            
            // Chuẩn bị dữ liệu cho 7 ngày qua
            const labels = [];
            const dataPoints = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date(Date.now() - i * 86400000);
                const dateString = d.toISOString().split('T')[0];
                const dayLabel = `${d.getDate()}/${d.getMonth() + 1}`;
                labels.push(dayLabel);
                
                const data = dailyData[dateString];
                if (data && data.total > 0) {
                    dataPoints.push(Math.round((data.score / data.total) * 100));
                } else {
                    dataPoints.push(null); // Cho phép có ngày không có dữ liệu
                }
            }

            if (chartInstance) {
                chartInstance.destroy(); // Hủy biểu đồ cũ trước khi vẽ mới
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Tỷ lệ Tuân thủ Trung bình (%)',
                        data: dataPoints,
                        borderColor: 'rgb(59, 130, 246)', // Màu xanh blue-600
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3, // Làm mượt đường
                        spanGaps: true // Nối qua các điểm null
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%'
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Tuân thủ: ${context.parsed.y}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- KHỞI ĐỘNG ỨNG DỤNG ---
        // Bắt đầu bằng cách hiển thị màn hình đăng nhập
        showView('loginView');

    </script>
</body>
</html>